# 背景音乐功能使用说明

## 功能简介

背景音乐功能允许您为任何视频添加背景音乐，支持多种音频处理选项和高质量输出。

## 功能特性

### 🎵 音频处理
- **智能混音**: 自动混合原始音频和背景音乐
- **音量控制**: 分别调节背景音乐和原始音频的音量
- **循环播放**: 音乐时长不足时自动循环播放
- **淡入淡出**: 支持自定义淡入淡出效果
- **时间控制**: 可设置音乐开始播放的时间点

### 🎬 视频处理
- **保持质量**: 视频流直接复制，不重新编码
- **格式兼容**: 支持多种常见视频和音频格式
- **原始音频**: 智能处理有/无原始音频的视频

## 支持格式

### 视频格式
- MP4, AVI, MOV, MKV, WMV, FLV

### 音频格式
- MP3, WAV, AAC, M4A, OGG, FLAC

## 使用方法

### 1. 启动程序
```bash
python cli.py
```

### 2. 选择功能
在主菜单中选择 `6. 背景音乐添加`

### 3. 输入文件路径
- 输入视频文件路径
- 输入音乐文件路径

### 4. 配置选项

#### 音量设置
- **背景音乐音量**: 0.0-1.0 (默认0.3，即30%)
- **原始音频音量**: 0.0-1.0 (默认0.7，即70%)

#### 播放选项
- **循环播放**: 是否循环音乐 (默认：是)
- **淡入时间**: 音乐淡入秒数 (默认2.0秒)
- **淡出时间**: 音乐淡出秒数 (默认2.0秒)
- **开始时间**: 音乐开始播放时间 (默认0.0秒)

#### 输出设置
- **输出文件名**: 自定义输出文件名
- **输出目录**: 指定输出目录 (默认：output)

## 配置示例

### 场景1: 为无声视频添加背景音乐
```
背景音乐音量: 0.8 (80%)
原始音频音量: 0.0 (不适用)
循环播放: 是
淡入时间: 3.0秒
淡出时间: 3.0秒
```

### 场景2: 为有声视频添加轻柔背景音乐
```
背景音乐音量: 0.2 (20%)
原始音频音量: 0.8 (80%)
循环播放: 是
淡入时间: 5.0秒
淡出时间: 5.0秒
```

### 场景3: 音乐MV制作
```
背景音乐音量: 0.9 (90%)
原始音频音量: 0.1 (10%)
循环播放: 否
淡入时间: 1.0秒
淡出时间: 2.0秒
开始时间: 10.0秒 (从音乐第10秒开始)
```

## 技术特点

### FFmpeg滤镜链
程序使用复杂的FFmpeg滤镜链来实现音频处理：
- `aloop`: 音频循环
- `atrim`: 音频裁剪
- `volume`: 音量调节
- `afade`: 淡入淡出
- `amix`: 音频混合

### 质量保证
- 视频流直接复制（`-c:v copy`）
- 音频编码使用AAC 128kbps高质量设置
- 保持原始视频分辨率和帧率

## 常见问题

### Q: 音乐时长比视频短怎么办？
A: 启用"循环播放"选项，音乐会自动循环播放直到视频结束。

### Q: 如何让背景音乐更突出？
A: 提高背景音乐音量（如0.7），降低原始音频音量（如0.3）。

### Q: 处理时间很长是正常的吗？
A: 由于使用了复杂的音频滤镜，处理时间会比简单复制长一些，这是正常的。

### Q: 支持哪些操作系统？
A: 支持Windows、Linux、macOS，需要Python 2.7和FFmpeg。

## 注意事项

1. **文件路径**: 确保视频和音频文件路径正确且文件存在
2. **磁盘空间**: 确保有足够的磁盘空间存储输出文件
3. **格式兼容**: 使用支持的视频和音频格式
4. **编码时间**: 复杂的音频处理需要一定时间，请耐心等待

## 示例输出

```
开始添加背景音乐...
输入视频: sample_video.mp4
背景音乐: background_music.mp3
视频时长: 120.5秒
音乐时长: 180.2秒
配置: 背景音量30%, 原音量70%, 循环:是, 淡入:2.0s, 淡出:2.0s
执行FFmpeg命令...
背景音乐添加成功！
输出文件: output/sample_video_with_music.mp4
文件大小: 45.2MB
```

---
*背景音乐功能由FFPR视频剪辑工具提供*
