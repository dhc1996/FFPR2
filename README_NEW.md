# 自动化视频剪辑工具 v2.0 - 完整使用指南

## 🎯 项目简介

这是一个基于 Python 2.7.18 和 FFmpeg 的专业视频剪辑工具套件，提供视频混剪和广告插入两大核心功能。

## ✨ 功能特性

### 🎬 视频混剪功能
- **智能扫描** - 自动识别文件夹中的视频文件
- **多种策略** - 随机混剪、顺序混剪、平衡混剪
- **高质量输出** - CRF 18 + slow 预设，确保优秀画质
- **音频处理** - 自动去除原声，避免版权问题
- **时长控制** - 灵活自定义输出视频时长

### 📺 广告插入功能 (NEW!)
- **精确控制** - 指定广告开始时间和显示时长
- **多种位置** - 支持四个角落位置选择
- **缩放调节** - 10%-50% 灵活调节广告大小
- **置顶显示** - 确保广告不被遮挡，符合"广告置顶展示不能被遮挡"要求
- **多广告支持** - 单个视频可插入多个不同广告

## 🛠️ 系统要求

- **Python 2.7.18** (必须使用此版本)
- **FFmpeg** (需添加到系统 PATH)
- **Windows 系统** (当前版本优化)

## 📦 快速开始

### 1. 运行主程序
```bash
python cli.py
```

### 2. 运行广告插入
```bash
python ad_cli.py
```

### 3. 系统测试
```bash
python test_integration.py
```

## 🎮 使用指南

### 视频混剪流程

1. **启动程序**
   ```bash
   python cli.py
   ```

2. **选择模式**
   - 选择 "1" - 自动扫描视频文件并混剪
   - 选择 "3" - 进入广告插入模式

3. **配置参数**
   - 输入视频目录路径
   - 设置目标时长(秒)
   - 选择混剪策略
   - 确认输出设置

### 广告插入流程

1. **启动广告程序**
   ```bash
   python ad_cli.py
   ```

2. **选择插入类型**
   - 单广告插入 - 插入一个广告
   - 多广告插入 - 插入多个广告

3. **配置广告参数**
   - 选择主视频和广告视频
   - 设置显示时间和时长
   - 选择位置和缩放比例

## ⚙️ 配置文件

### config.json 默认配置
```json
{
    "video": {
        "default_output_width": 1920,
        "default_output_height": 1080,
        "default_fps": 30,
        "default_crf": 18,
        "default_preset": "slow",
        "default_output_dir": "output"
    },
    "processing": {
        "temp_folder": "temp",
        "max_segment_length": 10.0,
        "min_segment_length": 2.0
    }
}
```

## 📁 项目结构

```
FFPR/
├── cli.py              # 主程序界面
├── ad_cli.py           # 广告插入界面
├── video_processor.py  # 视频处理核心
├── ad_inserter.py      # 广告插入核心  
├── ffmpeg_renderer.py  # FFmpeg渲染器
├── config.py           # 配置管理
├── utils.py            # 工具函数
├── test_integration.py # 集成测试
├── config.json         # 配置文件
├── output/             # 输出目录
└── temp/               # 临时文件目录
```

## 💡 使用技巧

### 广告插入最佳实践

1. **广告素材准备**
   - 时长建议：5-15秒
   - 格式推荐：MP4
   - 内容要求：简洁明了

2. **显示参数推荐**
   - **位置**：右上角效果最佳
   - **缩放**：25% 为最佳平衡
   - **时长**：10-15秒最合适

3. **时间安排策略**
   - 避开视频开头5秒
   - 避开视频结尾5秒  
   - 多广告间隔20秒以上

### 视频混剪优化

1. **素材选择**
   - 使用相近分辨率视频
   - 确保文件完整可播放
   - 推荐30秒以上时长

2. **策略选择**
   - **随机混剪** - 自然效果，日常推荐
   - **顺序混剪** - 有序感强
   - **平衡混剪** - 均匀使用所有素材

## 🔧 故障排除

### 常见问题解决

1. **FFmpeg 未找到**
   ```
   错误：FFmpeg 未找到
   解决：确保 FFmpeg 已安装并添加到 PATH
   ```

2. **Python 版本问题**
   ```
   错误：语法错误或编码问题
   解决：确保使用 Python 2.7.18
   ```

3. **视频处理失败**
   ```
   错误：视频格式不支持
   解决：转换为 MP4 格式
   ```

### 调试工具

运行系统测试：
```bash
python test_integration.py
```

## 📈 技术特性

### 核心技术
- **filter_complex** - FFmpeg 高级滤镜处理
- **CRF 编码** - 恒定质量视频编码
- **overlay 叠加** - 精确广告位置控制
- **时间轴控制** - 精确到秒的时间管理

### 性能优化
- **分段处理** - 避免内存溢出
- **临时文件管理** - 自动清理临时文件
- **多输入支持** - 同时处理多个视频源

## 📋 更新日志

### v2.0.0 (当前版本)
- ✅ 完整的广告插入功能
- ✅ 多位置广告显示
- ✅ 广告置顶显示保证
- ✅ 集成主程序菜单
- ✅ 完整测试套件

### v1.0.0 
- ✅ 基础视频混剪
- ✅ 高质量输出
- ✅ 多种混剪策略
- ✅ 自动音频处理

## 📞 技术支持

遇到问题时请：
1. 运行 `python test_integration.py` 检查系统状态
2. 确认 FFmpeg 和 Python 版本
3. 查看控制台错误信息
4. 检查视频文件格式和完整性

---

**免责声明**: 本工具仅供学习和个人使用，请遵守相关法律法规和版权规定。

**开发信息**: 基于 Python 2.7.18 + FFmpeg 开发，专为视频创作者设计。
